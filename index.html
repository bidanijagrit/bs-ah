<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BusPath - Haryana Bus Tracking</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #007bff, #00d4ff);
            margin: 0;
            padding: 0;
        }
        .splash-screen {
            position: fixed;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            color: #007bff;
            z-index: 9999;
        }
        .container {
            max-width: 400px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-top: 10px;
        }
        select, button {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        #map {
            height: 400px;
            border-radius: 10px;
            margin-top: 20px;
            width: 100%;
        }
        #eta {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="splash-screen" id="splash">BusPath Loading...</div>

<div class="container">
    <h2>BusPath - Haryana Bus Tracking</h2>

    <label>From:</label>
    <select id="fromStation"></select>

    <label>To:</label>
    <select id="toStation"></select>

    <button onclick="trackBus()">Track Bus</button>

    <div id="map"></div>
    <div id="eta"></div>
</div>

<script>
    // Splash Screen Hide after 3 seconds
    setTimeout(() => {
        document.getElementById("splash").style.display = "none";
    }, 3000);

    let stations = {
        "Ambala": [30.3782, 76.7767],
        "Bhiwani": [28.7996, 76.1320],
        "Charkhi Dadri": [28.6005, 76.2711],
        "Faridabad": [28.4089, 77.3178],
        "Fatehabad": [29.5246, 75.4556],
        "Gurugram": [28.4595, 77.0266],
        "Hisar": [29.1489, 75.7362],
        "Jhajjar": [28.6065, 76.6565],
        "Jind": [29.3162, 76.3144],
        "Kaithal": [29.8019, 76.3993],
        "Karnal": [29.6857, 76.9905],
        "Kurukshetra": [29.9695, 76.8783],
        "Mahendragarh": [28.2702, 76.1565],
        "Nuh": [28.1004, 76.9905],
        "Palwal": [28.1442, 77.3301],
        "Panchkula": [30.7363, 76.7884],
        "Panipat": [29.3909, 76.9635],
        "Rewari": [28.1904, 76.6180],
        "Rohtak": [29.0588, 76.0856],
        "Sirsa": [29.5336, 75.0317],
        "Sonipat": [28.9954, 77.0184],
        "Yamunanagar": [30.129, 77.2674]
    };

    let fromDropdown = document.getElementById("fromStation");
    let toDropdown = document.getElementById("toStation");

    for (let key in stations) {
        let option1 = new Option(key, key);
        let option2 = new Option(key, key);
        fromDropdown.add(option1);
        toDropdown.add(option2);
    }

    // Initialize Map Properly
    let map = L.map('map').setView([28.4595, 77.0266], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    function trackBus() {
        let fromStation = document.getElementById("fromStation").value;
        let toStation = document.getElementById("toStation").value;

        if (fromStation === toStation) {
            alert("Please select different stations!");
            return;
        }

        let fromLatLng = stations[fromStation];
        let toLatLng = stations[toStation];

        markers.forEach(marker => map.removeLayer(marker));
        markers = [];

        let fromMarker = L.marker(fromLatLng).addTo(map).bindPopup(`From: ${fromStation}`).openPopup();
        let toMarker = L.marker(toLatLng).addTo(map).bindPopup(`To: ${toStation}`);
        markers.push(fromMarker, toMarker);

        map.fitBounds([fromLatLng, toLatLng]);

        let distance = getDistance(fromLatLng[0], fromLatLng[1], toLatLng[0], toLatLng[1]);
        let etaTime = Math.round(distance / 50 * 60);
        document.getElementById('eta').innerHTML = `Estimated Travel Time: ${etaTime} minutes`;
    }

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) ** 2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }
</script>

</body>
</html>
